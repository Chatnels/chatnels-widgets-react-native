{"version":3,"sources":["ChatnelsWidget.tsx"],"names":["React","WebView","htmlTemplate","ChatnelsWidget","orgDomain","serviceProvider","sessionToken","viewData","onChatnelsEvent","onReady","onRequestSession","onError","webviewRef","useRef","source","setSource","useState","savedSessionToken","setSavedSessionToken","savedViewData","setSavedViewData","handleError","useCallback","e","handleMessage","event","type","data","JSON","parse","nativeEvent","useEffect","current","run","injectJavaScript","stringify","options","colorScheme","html","baseUrl","flex"],"mappings":"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","sourcesContent":["import * as React from 'react';\nimport { WebView } from 'react-native-webview';\nimport { htmlTemplate } from './htmlTemplate';\nimport type { ChatnelsWidgetProps, ChatnelsWidgetConfig } from './types';\n\nexport const ChatnelsWidget: React.FC<ChatnelsWidgetProps> = ({\n  orgDomain,\n  serviceProvider = 'chatnels.com',\n  sessionToken,\n  viewData,\n  onChatnelsEvent,\n  onReady,\n  onRequestSession,\n  onError,\n}) => {\n  const webviewRef = React.useRef<WebView>(null);\n  const [source, setSource] = React.useState<string>('');\n  const [savedSessionToken, setSavedSessionToken] =\n    React.useState(sessionToken);\n  const [savedViewData, setSavedViewData] =\n    React.useState<ChatnelsWidgetConfig>();\n\n  const handleError = React.useCallback(\n    (e) => {\n      if (onError) {\n        onError(e);\n      }\n    },\n    [onError]\n  );\n\n  const handleMessage = React.useCallback(\n    (event) => {\n      try {\n        const { type, data } = JSON.parse(event.nativeEvent.data);\n\n        if (type === 'reAuth') {\n          if (onRequestSession) {\n            onRequestSession();\n          }\n        } else if (type === 'app:ready') {\n          if (onReady) {\n            onReady();\n          }\n        } else if (onChatnelsEvent) {\n          onChatnelsEvent(type, data);\n        }\n      } catch (e) {}\n    },\n    [onChatnelsEvent, onReady, onRequestSession]\n  );\n\n  React.useEffect(() => {\n    if (orgDomain) {\n      setSource(\n        htmlTemplate(orgDomain, serviceProvider, sessionToken, viewData)\n      );\n    }\n  }, []);\n\n  React.useEffect(() => {\n    if (webviewRef.current) {\n      if (sessionToken !== savedSessionToken) {\n        setSavedSessionToken(sessionToken);\n        const run = `\n          if(window.ChatnelsClient) {\n            window.ChatnelsClient.updateSessionToken(\"${sessionToken}\");\n          }\n          true;\n        `;\n        webviewRef.current.injectJavaScript(run);\n      }\n    }\n  }, [sessionToken, savedSessionToken]);\n\n  React.useEffect(() => {\n    try {\n      if (webviewRef.current) {\n        if (JSON.stringify(savedViewData) !== JSON.stringify(viewData)) {\n          setSavedViewData(viewData);\n          const { type, data, options, colorScheme } = viewData;\n          const run = `\n            if(window.ChatnelsClient) {\n              window.ChatnelsClient.showView({\n                type: \"${type}\",\n                data: ${JSON.stringify(data)},\n                options: ${JSON.stringify(options)},\n                colorScheme: ${JSON.stringify(colorScheme)},\n              });\n            }\n            true;\n          `;\n          webviewRef.current.injectJavaScript(run);\n        }\n      }\n    } catch (e) {}\n  }, [viewData, savedViewData]);\n\n  return (\n    <WebView\n      ref={webviewRef}\n      source={{ html: source, baseUrl: 'chatnels://local.chatnels.com/' }}\n      style={{ flex: 1 }}\n      decelerationRate={'fast'}\n      domStorageEnabled={true}\n      injectedJavaScriptForMainFrameOnly={true}\n      injectedJavaScriptBeforeContentLoadedForMainFrameOnly={true}\n      javaScriptEnabled={true}\n      mixedContentMode={'always'}\n      originWhitelist={['*']}\n      overScrollMode={'never'}\n      thirdPartyCookiesEnabled={true}\n      onMessage={handleMessage}\n      onError={handleError}\n    />\n  );\n};\n"]}